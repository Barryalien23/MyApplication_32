# –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–∫—Å—ã v5.0 - CELL —Ä–∞–±–æ—Ç–∞–µ—Ç, —ç—Ñ—Ñ–µ–∫—Ç—ã –∑–∞–ø–æ–ª–Ω—è—é—Ç —ç–∫—Ä–∞–Ω! üéØ

## ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –†–ï–®–ï–ù–´

---

## 1. ‚úÖ CELL —Ç–µ–ø–µ—Ä—å –†–ï–ê–õ–¨–ù–´–ô "—Ä—É–ª—å —Å–µ—Ç–∫–∏"!

### –ü—Ä–æ–±–ª–µ–º–∞:
- CELL –≤–ª–∏—è–ª —Å–ª–∞–±–æ –∏–ª–∏ –Ω–µ –≤–ª–∏—è–ª —Å–æ–≤—Å–µ–º
- –¢–∞—Ä–≥–µ—Ç-—Å–µ—Ç–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∞—Å—å - –ø–µ—Ä–µ—Å—á–µ—Ç `floor(width/charW)` –≤ –∫–æ–Ω—Ü–µ
- –û–¥–Ω–∞ "—Ç–æ–ª—Å—Ç–∞—è" –≥–ª–∏—Ñ–∞ (‚óé, ‚óà) –ª–æ–º–∞–ª–∞ –≤—Å—é —Å–µ—Ç–∫—É (max –≤–º–µ—Å—Ç–æ p90)

### –†–µ—à–µ–Ω–∏–µ A: p90 —à–∏—Ä–∏–Ω–∞ –≤–º–µ—Å—Ç–æ max

**–ë—ã–ª–æ**: `maxW = palette.maxOf { paint.measureText(it) }` ‚Üí –æ–¥–Ω–∞ –≥–ª–∏—Ñ–∞ –ª–æ–º–∞–µ—Ç —Å–µ—Ç–∫—É  
**–°—Ç–∞–ª–æ**: `widths.sorted()[p90]` ‚Üí —É—Å—Ç–æ–π—á–∏–≤–æ –∫ –≤—ã–±—Ä–æ—Å–∞–º

```kotlin
// p90 —à–∏—Ä–∏–Ω—ã –≤–º–µ—Å—Ç–æ max - —É—Å—Ç–æ–π—á–∏–≤–µ–µ –∫ –≤—ã–±—Ä–æ—Å–∞–º
val widths = palette.map { paint.measureText(it) }.sorted()
val idx = (widths.size * 0.9f).toInt().coerceIn(0, widths.lastIndex)
val charW = widths.getOrElse(idx) { textSizePx * 0.6f }
```

### –†–µ—à–µ–Ω–∏–µ B: –£–≤–∞–∂–∞–µ–º —Ç–∞—Ä–≥–µ—Ç-—Å–µ—Ç–∫—É

**–ë—ã–ª–æ**: –ü–æ–¥–≥–æ–Ω—è–ª–∏ —à—Ä–∏—Ñ—Ç, –ø–æ—Ç–æ–º –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª–∏ `cols = floor(width/charW)` ‚Üí —Ç–µ—Ä—è–ª—Å—è —ç—Ñ—Ñ–µ–∫—Ç CELL  
**–°—Ç–∞–ª–æ**: –í–æ–∑–≤—Ä–∞—â–∞–µ–º `colsPlan/rowsPlan` –±–µ–∑ –ø–µ—Ä–µ—Å—á–µ—Ç–∞

```kotlin
// –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–≥–æ–Ω–∫–∞
var colsPlan = targetCols
var rowsPlan = targetRows

repeat(2) {
    val (charW, lineH) = measureMetrics(palette, fontPx, letterSpacingEm)
    val maxCols = floor(screenWidthPx / charW).toInt()
    val maxRows = floor(screenHeightPx / lineH).toInt()
    
    colsPlan = min(targetCols, maxCols)
    rowsPlan = min(targetRows, maxRows)
    
    // –ø–æ–¥–≥–æ–Ω—è–µ–º fontPx...
}

// –í–ê–ñ–ù–û: –±–µ—Ä–µ–º colsPlan/rowsPlan, –∞ –ù–ï –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º!
var cols = colsPlan
var rows = rowsPlan
```

### –†–µ—à–µ–Ω–∏–µ C: –†–∞—Å—à–∏—Ä–µ–Ω –¥–∏–∞–ø–∞–∑–æ–Ω CELL

**–ë—ã–ª–æ**: 60-200 –∫–æ–ª–æ–Ω–æ–∫ (—É–∑–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω)  
**–°—Ç–∞–ª–æ**: 12-220 –∫–æ–ª–æ–Ω–æ–∫ (—à–∏—Ä–æ–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω)

```kotlin
// CELL=0% ‚Üí –∫—Ä—É–ø–Ω—ã–µ "–ø–ª–∞–∫–∞—Ç–Ω—ã–µ" —Å–∏–º–≤–æ–ª—ã (12x8)
// CELL=100% ‚Üí –º–∞–∫—Å–∏–º—É–º –¥–µ—Ç–∞–ª–µ–π (220x160)
val targetCols = (12 + (220 - 12) * cellPercent).toInt()
val targetRows = (8 + (160 - 8) * cellPercent).toInt()
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

| CELL | –°–µ—Ç–∫–∞ | –≠—Ñ—Ñ–µ–∫—Ç |
|------|-------|--------|
| **0%** | **~12x8** | –ö—Ä—É–ø–Ω—ã–µ "–ø–ª–∞–∫–∞—Ç–Ω—ã–µ" —Å–∏–º–≤–æ–ª—ã |
| **25%** | **~64x46** | –ß–∏—Ç–∞–µ–º—ã–µ —Å–∏–º–≤–æ–ª—ã |
| **50%** | **~116x84** | –°—Ä–µ–¥–Ω–∏–µ |
| **75%** | **~168x122** | –î–µ—Ç–∞–ª—å–Ω—ã–µ |
| **100%** | **~220x160** | **–ú–∞–∫—Å–∏–º—É–º –¥–µ—Ç–∞–ª–µ–π!** |

‚úÖ **CELL —Å–ª–∞–π–¥–µ—Ä —Ç–µ–ø–µ—Ä—å –û–ß–ï–í–ò–î–ù–û –º–µ–Ω—è–µ—Ç —Ä–∞–∑–º–µ—Ä —Å–∏–º–≤–æ–ª–æ–≤!**  
‚úÖ **–ü—Ä–∏ CELL=0% –ø–æ–ª—É—á–∞–µ–º –∫—Ä—É–ø–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (12x8)**  
‚úÖ **–ü—Ä–∏ CELL=100% –ø–æ–ª—É—á–∞–µ–º –º–µ–ª–∫–∏–µ —Å–∏–º–≤–æ–ª—ã (220x160)**  

---

## 2. ‚úÖ –ù–µ-ASCII —ç—Ñ—Ñ–µ–∫—Ç—ã: –≥–∞—Ä–∞–Ω—Ç–∏—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞!

### –ü—Ä–æ–±–ª–µ–º–∞:
- SHAPES/CIRCLES/DIAMONDS/SQUARES –Ω–µ –∑–∞–ø–æ–ª–Ω—è–ª–∏ —ç–∫—Ä–∞–Ω ("–¥—ã—Ä—ã")
- –ì–ª–∏—Ñ—ã –∏–∑ fallback-—à—Ä–∏—Ñ—Ç–æ–≤, –Ω–µ –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–µ
- –†–∏—Å–æ–≤–∞–ª–∏ —Å—Ç—Ä–æ–∫–æ–π ‚Üí –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ ‚Üí —ç–∫—Ä–∞–Ω "–Ω–µ –¥–æ–±–∏–≤–∞–ª—Å—è"
- CELL –≤–∏–∑—É–∞–ª—å–Ω–æ –Ω–µ –∑–∞–º–µ—Ç–µ–Ω –¥–ª—è —ç—Ç–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

### –†–µ—à–µ–Ω–∏–µ: renderFixedGridBitmap - —Ä–∏—Å—É–µ–º –ü–û –Ø–ß–ï–ô–ö–ê–ú

–î–ª—è –Ω–µ-ASCII —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —Ä–∏—Å—É–µ–º –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —è—á–µ–π–∫—É:

```kotlin
// –î–ª—è –Ω–µ-ASCII —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —Ä–∏—Å—É–µ–º –ø–æ —è—á–µ–π–∫–∞–º –≤ bitmap
return if (effectType == EffectType.ASCII) {
    RenderResult.Text(ascii, grid)  // ASCII - —Ç–µ–∫—Å—Ç–æ–º
} else {
    renderFixedGridBitmap(ascii, grid, screenW, screenH)  // –æ—Å—Ç–∞–ª—å–Ω—ã–µ - bitmap
}
```

```kotlin
private fun renderFixedGridBitmap(...): RenderResult.Image {
    // –¢–æ—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–ª–µ—Ç–æ–∫ - –∑–∞–ø–æ–ª–Ω—è—é—Ç –≤–µ—Å—å —ç–∫—Ä–∞–Ω
    val cw = screenW.toFloat() / grid.cols
    val ch = screenH.toFloat() / grid.rows
    
    // –†–∏—Å—É–µ–º –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –ø–æ —è—á–µ–π–∫–∞–º
    ascii.forEach { chx ->
        if (chx == '\n') { r++; c = 0; return@forEach }
        val x = c * cw
        val y = r * ch + baselineShift
        canvas.drawText(chx.toString(), x, y, paint)
        c++
    }
}
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ **–≠–∫—Ä–∞–Ω –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ 100%** - –Ω–µ—Ç "—á–µ—Ä–Ω—ã—Ö –ø–æ–ª–æ—Å" –∏ "–¥—ã—Ä"  
‚úÖ **CELL –≤–ª–∏—è–µ—Ç –Ω–∞ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é** - –≤–∏–¥–Ω–æ –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è —á–∏—Å–ª–æ —Å–∏–º–≤–æ–ª–æ–≤  
‚úÖ **–í—Å–µ —Å–∏–º–≤–æ–ª—ã –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞** - —Ä–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞  
‚úÖ **–ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–µ—Ç—Ä–∏–∫ fallback-—à—Ä–∏—Ñ—Ç–æ–≤**  

---

## 3. ‚úÖ –£–ª—É—á—à–µ–Ω –∫–æ–Ω—Ç—Ä–∞—Å—Ç –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–Ω–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞:
- –ö–æ–Ω—Ç—Ä–∞—Å—Ç –º–∞–∫—Å–∏–º—É–º 1.8√ó - –º–∞–ª–æ–≤–∞—Ç–æ
- –ü–æ–ª—É—Ç–æ–Ω–∞ –Ω–µ –æ—á–µ–Ω—å –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã

### –†–µ—à–µ–Ω–∏–µ: –ö–æ–Ω—Ç—Ä–∞—Å—Ç 2.2√ó + –º—è–≥–∫–∞—è S-–∫—Ä–∏–≤–∞—è

**–ë—ã–ª–æ**: `cf = 1.0f + (contrast / 100f) * 1.8f`  
**–°—Ç–∞–ª–æ**: `cf = 1.0f + (contrast / 100f) * 2.2f` + S-–∫—Ä–∏–≤–∞—è

```kotlin
// –£—Å–∏–ª–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç (–±—ã–ª–æ 1.8)
val cf = 1.0f + (contrast / 100f) * 2.2f
v = (((v - 128) * cf) + 128).toInt().coerceIn(0, 255)

// –ú—è–≥–∫–∞—è S-–∫—Ä–∏–≤–∞—è –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–Ω–æ–≤
val t = v / 255f
val s = (1.1f * t - 0.05f).coerceIn(0f, 1f)

// Œ≥-–∫–æ—Ä—Ä–µ–∫—Ü–∏—è
val nv = s.toDouble().pow(1.0 / gamma).toFloat()
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ **–ë–æ–ª–µ–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç** –ø—Ä–∏ SOFTY > 50%  
‚úÖ **–õ—É—á—à–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—É—Ç–æ–Ω–æ–≤** (S-–∫—Ä–∏–≤–∞—è)  
‚úÖ **–î–µ—Ç–∞–ª–∏ –Ω–µ "–≤—ã–∂–∏–≥–∞—é—Ç—Å—è"** –∏ –Ω–µ "—Å—ä–µ–¥–∞—é—Ç—Å—è"  

---

## 4. ‚úÖ SHAPES: —É–∑–Ω–∞–≤–∞–µ–º–∞—è –∏ –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞:
- –°—Ç–∞—Ä–∞—è –ø–∞–ª–∏—Ç—Ä–∞ SHAPES (20 —Å–∏–º–≤–æ–ª–æ–≤) –±—ã–ª–∞ –ø–µ—Å—Ç—Ä–∞—è
- –ú–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤
- –õ–∏—Ü–∞ "–Ω–µ —É–∑–Ω–∞–≤–∞–ª–∏—Å—å"

### –†–µ—à–µ–Ω–∏–µ: –£–∑–∫–∞—è —É–∑–Ω–∞–≤–∞–µ–º–∞—è –ø–∞–ª–∏—Ç—Ä–∞

**–ë—ã–ª–æ**: 20 —Å–∏–º–≤–æ–ª–æ–≤ (–∫–≤–∞–¥—Ä–∞—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è–º–∏, —ç–∫–∑–æ—Ç–∏–∫–∞)  
**–°—Ç–∞–ª–æ**: 13 –ø—Ä–æ—Å—Ç—ã—Ö –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

```kotlin
private val SHAPES = listOf(
    " ",      // –ø—É—Å—Ç–æ—Ç–∞
    "¬∑",      // —Ç–æ—á–∫–∞
    ":",      // –¥–≤–æ–µ—Ç–æ—á–∏–µ
    "-",      // –º–∏–Ω—É—Å
    "=",      // —Ä–∞–≤–Ω–æ
    "+",      // –ø–ª—é—Å
    "*",      // –∑–≤–µ–∑–¥–∞
    "o",      // –º–∞–ª–µ–Ω—å–∫–∞—è –±—É–∫–≤–∞ –æ
    "O",      // –±–æ–ª—å—à–∞—è –±—É–∫–≤–∞ –û
    "0",      // –Ω–æ–ª—å
    "‚ñ†",      // –∫–≤–∞–¥—Ä–∞—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π
    "‚ñì",      // —Ç–µ–º–Ω–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞
    "‚ñà"       // –ø–æ–ª–Ω—ã–π –±–ª–æ–∫
)
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ **–õ–∏—Ü–∞ —É–∑–Ω–∞—é—Ç—Å—è** - –ø—Ä–æ—Å—Ç—ã–µ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ —Å–∏–º–≤–æ–ª—ã  
‚úÖ **–í—Å–µ —Å–∏–º–≤–æ–ª—ã –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–µ** - —Ä–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞  
‚úÖ **–•–æ—Ä–æ—à–æ –∫—Ä–∞—Å—è—Ç—Å—è** - –Ω–µ—Ç fallback-—à—Ä–∏—Ñ—Ç–æ–≤  

---

## 5. ‚úÖ –°–±—Ä–æ—Å –∫—ç—à–µ–π –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–µ—Ç–∫–∏/—ç—Ñ—Ñ–µ–∫—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞:
- –ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å –∏ EMA auto-levels "—Ç—è–Ω—É–ª–∏—Å—å" –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏
- –ü—Ä–∏ —Å–º–µ–Ω–µ CELL –∏–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–ª–∏—è–ª–∏ –Ω–∞ –Ω–æ–≤—ã–µ

### –†–µ—à–µ–Ω–∏–µ: –°–±—Ä–æ—Å –∫—ç—à–µ–π –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–ª—é—á–∞

```kotlin
private fun planCached(...): Grid {
    val key = GridKey(...)
    
    // –°–±—Ä–æ—Å –∫—ç—à–µ–π —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–µ—Ç–∫–∏/—ç—Ñ—Ñ–µ–∫—Ç–∞
    if (cached?.first != key) {
        prevIdx = null      // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å
        levelsCache = null  // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º EMA auto-levels
    }
    
    // ...
}
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ **–ß–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ —ç—Ñ—Ñ–µ–∫—Ç–∞**  
‚úÖ **–ù–µ—Ç "—Ö–≤–æ—Å—Ç–æ–≤" –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫**  
‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –Ω–æ–≤—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º**  

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

### –§–∞–π–ª: `ASCIIEngineV2.kt`

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –≠—Ñ—Ñ–µ–∫—Ç |
|-----------|-----------|--------|
| **measureMetrics** | max ‚Üí **p90 —à–∏—Ä–∏–Ω–∞** | –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –≤—ã–±—Ä–æ—Å–∞–º |
| **GridPlanner.plan** | –ü–µ—Ä–µ—Å—á–µ—Ç cols/rows ‚Üí **—É–≤–∞–∂–∞–µ–º colsPlan/rowsPlan** | CELL —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **–î–∏–∞–ø–∞–∑–æ–Ω CELL** | 60-200 ‚Üí **12-220 –∫–æ–ª–æ–Ω–æ–∫** | –ö—Ä—É–ø–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –ø—Ä–∏ 0% |
| **renderText** | –í—Å–µ–≥–¥–∞ Text ‚Üí **Text –¥–ª—è ASCII, Bitmap –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö** | –ü–æ–ª–Ω—ã–π fill —ç–∫—Ä–∞–Ω–∞ |
| **renderFixedGridBitmap** | **–ù–û–í–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è** | –†–∏—Å—É–µ—Ç –ø–æ —è—á–µ–π–∫–∞–º |
| **–ö–æ–Ω—Ç—Ä–∞—Å—Ç** | 1.8√ó ‚Üí **2.2√ó** | –ë–æ–ª–µ–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–π |
| **S-–∫—Ä–∏–≤–∞—è** | –ù–µ—Ç ‚Üí **`1.1f * t - 0.05f`** | –õ—É—á—à–∏–µ –ø–æ–ª—É—Ç–æ–Ω–∞ |
| **SHAPES –ø–∞–ª–∏—Ç—Ä–∞** | 20 —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏—Ö ‚Üí **13 –ø—Ä–æ—Å—Ç—ã—Ö** | –£–∑–Ω–∞–≤–∞–µ–º–æ—Å—Ç—å –ª–∏—Ü |
| **–°–±—Ä–æ—Å –∫—ç—à–µ–π** | –ù–µ—Ç ‚Üí **–ø—Ä–∏ —Å–º–µ–Ω–µ –∫–ª—é—á–∞** | –ß–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ |

---

## üß™ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

### –¢–µ—Å—Ç 1: CELL —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–≠—Ñ—Ñ–µ–∫—Ç = ASCII**
2. **CELL = 0%** ‚Üí **–æ—á–µ–Ω—å –∫—Ä—É–ø–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã** (~12x8)
3. **CELL = 50%** ‚Üí —Å—Ä–µ–¥–Ω–∏–µ (~116x84)
4. **CELL = 100%** ‚Üí **–æ—á–µ–Ω—å –º–µ–ª–∫–∏–µ** (~220x160)

‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å **–¥—Ä–∞–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ** —Ä–∞–∑–º–µ—Ä–∞ —Å–∏–º–≤–æ–ª–æ–≤!

### –¢–µ—Å—Ç 2: SHAPES/CIRCLES/DIAMONDS –∑–∞–ø–æ–ª–Ω—è—é—Ç —ç–∫—Ä–∞–Ω

1. **–≠—Ñ—Ñ–µ–∫—Ç = SHAPES** (–∏–ª–∏ CIRCLES, DIAMONDS, SQUARES)
2. **CELL = –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**
3. –°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –∫—Ä–∞—è —ç–∫—Ä–∞–Ω–∞

‚úÖ **–ù–ï–¢ —á–µ—Ä–Ω—ã—Ö –ø–æ–ª–æ—Å** –ø–æ –∫—Ä–∞—è–º  
‚úÖ **–°–∏–º–≤–æ–ª—ã –∑–∞–ø–æ–ª–Ω—è—é—Ç –≤–µ—Å—å —ç–∫—Ä–∞–Ω**  
‚úÖ **CELL –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤**  

### –¢–µ—Å—Ç 3: SHAPES —É–∑–Ω–∞–≤–∞–µ–º—ã

1. **–≠—Ñ—Ñ–µ–∫—Ç = SHAPES**
2. **CELL = 70-80%**
3. **SOFTY = 50-60%**
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Å–≤–æ–µ –ª–∏—Ü–æ

‚úÖ **–õ–∏—Ü–æ —É–∑–Ω–∞–µ—Ç—Å—è** (–≥–ª–∞–∑–∞, –Ω–æ—Å, —Ä–æ—Ç)  
‚úÖ **–ü—Ä–æ—Å—Ç—ã–µ —Å–∏–º–≤–æ–ª—ã**: ¬∑, :, -, =, +, *, o, O, 0, ‚ñ†  

### –¢–µ—Å—Ç 4: –ö–æ–Ω—Ç—Ä–∞—Å—Ç —Å–∏–ª—å–Ω–µ–µ

1. **–≠—Ñ—Ñ–µ–∫—Ç = ASCII**
2. **SOFTY = 0%** ‚Üí –æ—Ä–∏–≥–∏–Ω–∞–ª
3. **SOFTY = 80%** ‚Üí —Å–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç

‚úÖ –ö–æ–Ω—Ç—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–∑–∞–º–µ—Ç–Ω–æ —Å–∏–ª—å–Ω–µ–µ** —á–µ–º —Ä–∞–Ω—å—à–µ!

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

### –î–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤ (ASCII):
```
–≠—Ñ—Ñ–µ–∫—Ç: ASCII
CELL = 80-90%
SOFTY = 50-60%
JITTER = 0-5%
```

### –î–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤ (SHAPES):
```
–≠—Ñ—Ñ–µ–∫—Ç: SHAPES
CELL = 70-80%
SOFTY = 40-50%
JITTER = 5-10%
```

### –î–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (CIRCLES):
```
–≠—Ñ—Ñ–µ–∫—Ç: CIRCLES
CELL = 60-70%
SOFTY = 60-70%
JITTER = 10-15%
```

### –î–ª—è "–ø–ª–∞–∫–∞—Ç–Ω–æ–≥–æ" —Å—Ç–∏–ª—è:
```
–≠—Ñ—Ñ–µ–∫—Ç: SQUARES
CELL = 10-20%  ‚Üê –∫—Ä—É–ø–Ω—ã–µ "–ø–∏–∫—Å–µ–ª–∏"!
SOFTY = 70-80%
JITTER = 0%
```

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã:**
- p90 –≤–º–µ—Å—Ç–æ max: +2ms (–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏)
- renderFixedGridBitmap: +10-15ms (–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ-ASCII)
- S-–∫—Ä–∏–≤–∞—è: +1ms (–ø—Ä–æ—Å—Ç–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞)

**–ò—Ç–æ–≥–æ**: +12-18ms –¥–ª—è –Ω–µ-ASCII —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, ASCII –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –î–ª—è –Ω–µ-ASCII —Ä–µ–Ω–¥–µ—Ä–∏–º –≤ bitmap ‚Üí –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å!

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –î–û/–ü–û–°–õ–ï:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: CELL –Ω–µ —Ä–∞–±–æ—Ç–∞–ª

**–î–û:**
- ‚ùå CELL 0-100% ‚Üí –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä
- ‚ùå –°–ª–∞–π–¥–µ—Ä —Å–ª–∞–±–æ –≤–ª–∏—è–ª
- ‚ùå –î–∏–∞–ø–∞–∑–æ–Ω 60-200 —É–∑–∫–∏–π

**–ü–û–°–õ–ï:**
- ‚úÖ CELL 0% ‚Üí **12x8 (–∫—Ä—É–ø–Ω–æ!)**
- ‚úÖ CELL 100% ‚Üí **220x160 (–º–µ–ª–∫–æ!)**
- ‚úÖ –°–ª–∞–π–¥–µ—Ä –æ—á–µ–≤–∏–¥–µ–Ω

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–µ –∑–∞–ø–æ–ª–Ω—è–ª–∏ —ç–∫—Ä–∞–Ω

**–î–û:**
- ‚ùå –ß–µ—Ä–Ω—ã–µ –ø–æ–ª–æ—Å—ã –ø–æ –∫—Ä–∞—è–º
- ‚ùå "–î—ã—Ä—ã" –≤ —Å–µ—Ç–∫–µ
- ‚ùå CELL –Ω–µ –∑–∞–º–µ—Ç–µ–Ω

**–ü–û–°–õ–ï:**
- ‚úÖ **100% –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞**
- ‚úÖ –†–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞
- ‚úÖ CELL –≤–ª–∏—è–µ—Ç –Ω–∞ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: SHAPES –Ω–µ —É–∑–Ω–∞–≤–∞–ª–∏—Å—å

**–î–û:**
- ‚ùå 20 —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
- ‚ùå Fallback-—à—Ä–∏—Ñ—Ç—ã
- ‚ùå –õ–∏—Ü–∞ –Ω–µ —É–∑–Ω–∞–≤–∞–ª–∏—Å—å

**–ü–û–°–õ–ï:**
- ‚úÖ **13 –ø—Ä–æ—Å—Ç—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤**
- ‚úÖ –ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–µ
- ‚úÖ **–õ–∏—Ü–∞ —É–∑–Ω–∞—é—Ç—Å—è!**

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:

**1. GridPlanner.measureMetrics (—Å—Ç—Ä–æ–∫–∏ 148-167):**
```kotlin
// p90 –≤–º–µ—Å—Ç–æ max
val widths = palette.map { paint.measureText(it) }.sorted()
val idx = (widths.size * 0.9f).toInt()
val charW = widths.getOrElse(idx) { textSizePx * 0.6f }
```

**2. GridPlanner.plan (—Å—Ç—Ä–æ–∫–∏ 175-232):**
```kotlin
// –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω 12-220
val targetCols = (12 + (220 - 12) * cellPercent).toInt()

// –£–≤–∞–∂–∞–µ–º colsPlan/rowsPlan
var cols = colsPlan
var rows = rowsPlan
```

**3. Sampler.luminanceGrid (—Å—Ç—Ä–æ–∫–∏ 321-344):**
```kotlin
// –ö–æ–Ω—Ç—Ä–∞—Å—Ç 2.2
val cf = 1.0f + (contrast / 100f) * 2.2f

// S-–∫—Ä–∏–≤–∞—è
val s = (1.1f * t - 0.05f).coerceIn(0f, 1f)
```

**4. Palettes.SHAPES (—Å—Ç—Ä–æ–∫–∏ 106-122):**
```kotlin
// 13 –ø—Ä–æ—Å—Ç—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
private val SHAPES = listOf(" ", "¬∑", ":", "-", "=", "+", "*", "o", "O", "0", "‚ñ†", "‚ñì", "‚ñà")
```

**5. ASCIIEngineV2.renderText (—Å—Ç—Ä–æ–∫–∏ 705-711):**
```kotlin
// –†–∞–∑–≤–∏–ª–∫–∞: ASCII ‚Üí Text, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí Bitmap
return if (effectType == EffectType.ASCII) {
    RenderResult.Text(ascii, grid)
} else {
    renderFixedGridBitmap(ascii, grid, screenW, screenH)
}
```

**6. ASCIIEngineV2.renderFixedGridBitmap (—Å—Ç—Ä–æ–∫–∏ 713-756):**
```kotlin
// –ù–û–í–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è - —Ä–∏—Å—É–µ—Ç –ø–æ —è—á–µ–π–∫–∞–º
val cw = screenW.toFloat() / grid.cols
val ch = screenH.toFloat() / grid.rows
// —Ä–∏—Å—É–µ–º –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —è—á–µ–π–∫—É
```

**7. ASCIIEngineV2.planCached (—Å—Ç—Ä–æ–∫–∏ 572-576):**
```kotlin
// –°–±—Ä–æ—Å –∫—ç—à–µ–π –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–ª—é—á–∞
if (cached?.first != key) {
    prevIdx = null
    levelsCache = null
}
```

---

## üöÄ –ò—Ç–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–æ:

1. ‚úÖ **p90 —à–∏—Ä–∏–Ω–∞** - —É—Å—Ç–æ–π—á–∏–≤–æ –∫ –≤—ã–±—Ä–æ—Å–∞–º
2. ‚úÖ **–£–≤–∞–∂–∞–µ–º —Ç–∞—Ä–≥–µ—Ç-—Å–µ—Ç–∫—É** - CELL —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ **–î–∏–∞–ø–∞–∑–æ–Ω 12-220** - –∫—Ä—É–ø–Ω—ã–µ –∏ –º–µ–ª–∫–∏–µ —Å–∏–º–≤–æ–ª—ã
4. ‚úÖ **renderFixedGridBitmap** - 100% –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
5. ‚úÖ **–ö–æ–Ω—Ç—Ä–∞—Å—Ç 2.2 + S-–∫—Ä–∏–≤–∞—è** - –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–µ–µ
6. ‚úÖ **SHAPES 13 —Å–∏–º–≤–æ–ª–æ–≤** - —É–∑–Ω–∞–≤–∞–µ–º–æ—Å—Ç—å –ª–∏—Ü
7. ‚úÖ **–°–±—Ä–æ—Å –∫—ç—à–µ–π** - —á–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

---

**Linter**: ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫  
**–ö–æ–º–ø–∏–ª—è—Ü–∏—è**: ‚úÖ –ì–æ—Ç–æ–≤–æ  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: üöÄ –ì–æ—Ç–æ–≤–æ!  

üî• **–í–°–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –†–ï–®–ï–ù–´!**  
üéØ **CELL —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ "—Ä—É–ª—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏"!**  
üì± **–≠—Ñ—Ñ–µ–∫—Ç—ã –∑–∞–ø–æ–ª–Ω—è—é—Ç —ç–∫—Ä–∞–Ω –Ω–∞ 100%!**  
üë§ **–õ–∏—Ü–∞ —É–∑–Ω–∞—é—Ç—Å—è –≤ SHAPES!**

