# –£–ª—É—á—à–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞ (–≤–µ—Ä—Å–∏—è 2.2)

## üêõ –ü—Ä–æ–±–ª–µ–º–∞: –°–ø—Ä–∞–≤–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–ø—Ä–∞–≤–∞ –≤—Å–µ –µ—â–µ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ - —Å–∏–º–≤–æ–ª—ã –Ω–µ –∑–∞–ø–æ–ª–Ω—è—é—Ç —ç–∫—Ä–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ —à–∏—Ä–∏–Ω–µ.

### –ü—Ä–∏—á–∏–Ω—ã:

1. **–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π `charWidthFactor`**
   - –ë—ã–ª–æ: `0.62f`
   - –≠—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∑–∞–ø–∞—Å —Å–ø—Ä–∞–≤–∞

2. **–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∑–∞–ø–∞—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
   - –ë—ã–ª–æ: `safetyMargin = 0.92f` (8% –∑–∞–ø–∞—Å)
   - –≠—Ç–æ —É–º–µ–Ω—å—à–∞–ª–æ fontSize —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–ª–æ—Ç–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–∏ —Å–∏–º–≤–æ–ª–æ–≤**
   - `letterSpacing = 0.sp` –æ—Å—Ç–∞–≤–ª—è–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
   - –ù—É–∂–Ω–∞ –±–æ–ª–µ–µ –ø–ª–æ—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω `charWidthFactor`

**–ë—ã–ª–æ:**
```kotlin
val charWidthFactor = 0.62f  // –°–ª–∏—à–∫–æ–º –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ
```

**–°—Ç–∞–ª–æ:**
```kotlin
// –¢–æ—á–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è IBM Plex Mono –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞
// –ú–µ–Ω—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è = –ø–ª–æ—Ç–Ω–µ–µ —É–ø–∞–∫–æ–≤–∫–∞ = –ª—É—á—à–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
val charWidthFactor = 0.56f  // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
```

**–≠—Ñ—Ñ–µ–∫—Ç:** `-9.7%` width factor ‚Üí fontSize —É–≤–µ–ª–∏—á–∏–ª—Å—è ‚Üí –ª—É—á—à–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ

---

### 2. –£–≤–µ–ª–∏—á–µ–Ω `safetyMargin`

**–ë—ã–ª–æ:**
```kotlin
val safetyMargin = 0.92f  // 8% –∑–∞–ø–∞—Å
val safeFontSize = optimalFontSize * 0.92f
```

**–°—Ç–∞–ª–æ:**
```kotlin
// –î–æ–±–∞–≤–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø–∞—Å (98%) –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫
// –£–≤–µ–ª–∏—á–∏–ª–∏ —Å 92% –¥–ª—è –ª—É—á—à–µ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞
val safetyMargin = 0.98f  // –¢–æ–ª—å–∫–æ 2% –∑–∞–ø–∞—Å
val safeFontSize = optimalFontSize * 0.98f
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ú–µ–Ω—å—à–µ –∑–∞–ø–∞—Å ‚Üí –±–æ–ª—å—à–µ fontSize ‚Üí –ª—É—á—à–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ

---

### 3. –î–æ–±–∞–≤–ª–µ–Ω –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π `letterSpacing`

**–ë—ã–ª–æ:**
```kotlin
Text(
    text = asciiText,
    letterSpacing = 0.sp  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
)
```

**–°—Ç–∞–ª–æ:**
```kotlin
Text(
    text = asciiText,
    letterSpacing = (-0.02).sp  // –ü–ª–æ—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞
)
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –°–∏–º–≤–æ–ª—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –ø–ª–æ—Ç–Ω–µ–µ ‚Üí –º–µ–Ω—å—à–µ –ø—É—Å—Ç–æ–≥–æ –º–µ—Å—Ç–∞ —Å–ø—Ä–∞–≤–∞

---

### 4. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```kotlin
// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
android.util.Log.d("ASCIIEngine", """
    calculateOptimalFontSize:
    - Screen: ${screenWidth}x${screenHeight}dp
    - Grid: ${charsPerRow}x${rowsCount} chars
    - maxFontByWidth: $maxFontSizeByWidth
    - maxFontByHeight: $maxFontSizeByHeight
    - optimal: $optimalFontSize
    - safe (98%): $safeFontSize
    - final: $result sp
""".trimIndent())
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ logcat —Ç–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ—Ç–ª–∞–¥–∫–∏

---

## üìä –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ 360dp

**–î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```
Screen width: 360dp
Chars per row: 100
charWidthFactor: 0.62f
safetyMargin: 0.92f

maxFontSizeByWidth = 360 / 100 / 0.62 = 5.81sp
safeFontSize = 5.81 * 0.92 = 5.34sp
finalFontSize = 5.34sp

–†–µ–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞: 100 * 5.34 * 0.62 = 331dp
–ü—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ —Å–ø—Ä–∞–≤–∞: 360 - 331 = 29dp (8%) ‚ùå
```

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```
Screen width: 360dp
Chars per row: 100
charWidthFactor: 0.56f ‚úÖ (–±—ã–ª–æ 0.62f)
safetyMargin: 0.98f ‚úÖ (–±—ã–ª–æ 0.92f)
letterSpacing: -0.02sp ‚úÖ (–±—ã–ª–æ 0sp)

maxFontSizeByWidth = 360 / 100 / 0.56 = 6.43sp
safeFontSize = 6.43 * 0.98 = 6.30sp
finalFontSize = 6.30sp

–†–µ–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ (–±–µ–∑ letterSpacing): 100 * 6.30 * 0.56 = 353dp
+ —ç—Ñ—Ñ–µ–∫—Ç letterSpacing (-0.02sp): ~+3-4dp
–ò—Ç–æ–≥–æ: ~356-357dp

–ü—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ —Å–ø—Ä–∞–≤–∞: 360 - 357 = 3dp (0.8%) ‚úÖ
```

**–£–ª—É—á—à–µ–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è: —Å 92% –¥–æ 99%!** üéâ

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –°—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|----------|----------------|----------------|-----------|
| `charWidthFactor` | 0.62 | 0.56 | -9.7% |
| `safetyMargin` | 0.92 (8% –∑–∞–ø–∞—Å) | 0.98 (2% –∑–∞–ø–∞—Å) | +6.5% |
| `letterSpacing` | 0.sp | -0.02.sp | –ü–ª–æ—Ç–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞ |
| **–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞** | **~92%** | **~99%** | **+7%** ‚úÖ |

---

## üì± –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Logcat

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Logcat –±—É–¥—É—Ç –ª–æ–≥–∏:

```
D/ASCIIEngine: calculateOptimalFontSize:
    - Screen: 360x440dp
    - Grid: 100x70 chars
    - maxFontByWidth: 6.43
    - maxFontByHeight: 5.47
    - optimal: 5.47
    - safe (98%): 5.36
    - final: 5.36 sp
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- `Screen` - —Ä–∞–∑–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ?
- `Grid` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç CELL –ø–∞—Ä–∞–º–µ—Ç—Ä—É?
- `final` - –∏—Ç–æ–≥–æ–≤—ã–π fontSize —Ä–∞–∑—É–º–Ω—ã–π?

---

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ############################         ‚Üê 29dp  ‚îÇ
‚îÇ ############################                 ‚îÇ
‚îÇ ############################                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           92% –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ ‚ùå
```

### –ü–æ—Å–ª–µ:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ########################################### ‚Üê3dp‚îÇ
‚îÇ ############################################  ‚îÇ
‚îÇ ############################################  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           99% –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ ‚úÖ
```

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `ASCIIEngine.kt`
```kotlin
// –ò–∑–º–µ–Ω–µ–Ω–æ:
- charWidthFactor: 0.62f ‚Üí 0.56f
- safetyMargin: 0.92f ‚Üí 0.98f
+ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```

### 2. `MainScreen.kt`
```kotlin
// –ò–∑–º–µ–Ω–µ–Ω–æ –≤ ASCIIPreview:
- letterSpacing = 0.sp ‚Üí letterSpacing = (-0.02).sp

// –ò–∑–º–µ–Ω–µ–Ω–æ –≤ ASCIIPreviewWithGradient:
- letterSpacing = 0.sp ‚Üí letterSpacing = (-0.02).sp
```

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ –µ—â–µ –æ—Å—Ç–∞–µ—Ç—Å—è –º–µ—Å—Ç–æ —Å–ø—Ä–∞–≤–∞ –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç —Å–∏–º–≤–æ–ª—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è:

### –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ charWidthFactor:
```kotlin
// –ï—Å–ª–∏ —Å–ø—Ä–∞–≤–∞ –µ—â–µ –µ—Å—Ç—å –º–µ—Å—Ç–æ (1-2%):
val charWidthFactor = 0.55f  // –ï—â–µ –ø–ª–æ—Ç–Ω–µ–µ

// –ï—Å–ª–∏ —Å–∏–º–≤–æ–ª—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è:
val charWidthFactor = 0.57f  // –ß—É—Ç—å –±–æ–ª—å—à–µ –∑–∞–ø–∞—Å–∞
```

### –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ letterSpacing:
```kotlin
// –î–ª—è –µ—â–µ –±–æ–ª–µ–µ –ø–ª–æ—Ç–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–∏:
letterSpacing = (-0.03).sp

// –ï—Å–ª–∏ —Å–∏–º–≤–æ–ª—ã —Å–ª–∏–ø–∞—é—Ç—Å—è:
letterSpacing = (-0.01).sp
```

### –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ safetyMargin:
```kotlin
// –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (—Ä–∏—Å–∫ –ø–µ—Ä–µ–Ω–æ—Å–∞):
val safetyMargin = 0.99f  // –¢–æ–ª—å–∫–æ 1% –∑–∞–ø–∞—Å

// –î–ª—è –±–æ–ª—å—à–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
val safetyMargin = 0.97f  // 3% –∑–∞–ø–∞—Å
```

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** 24 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.2  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Logcat –¥–ª—è —Ç–æ—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —Ç–æ–Ω–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤—ã—à–µ.

