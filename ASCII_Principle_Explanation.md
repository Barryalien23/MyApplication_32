# 🎯 Принцип работы ASCII эффекта

## 📊 Как работает отображение символов

```
┌─────────────────────────────────────────────────────────────┐
│                    ИСХОДНОЕ ИЗОБРАЖЕНИЕ                     │
│  ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐    │
│  │ 255 │ 200 │ 150 │ 100 │ 50  │ 25  │ 10  │ 5   │ 0   │    │
│  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤    │
│  │ 200 │ 180 │ 120 │ 80  │ 40  │ 20  │ 8   │ 3   │ 1   │    │
│  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤    │
│  │ 150 │ 120 │ 90  │ 60  │ 30  │ 15  │ 6   │ 2   │ 0   │    │
│  └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    ASCII СЕТКА                              │
│  ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐    │
│  │  @  │  #  │  %  │  *  │  +  │  -  │  .  │  `  │     │    │
│  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤    │
│  │  #  │  %  │  *  │  +  │  -  │  .  │  `  │  '  │  .  │    │
│  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤    │
│  │  %  │  *  │  +  │  -  │  .  │  `  │  '  │  .  │     │    │
│  └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘    │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 Алгоритм конвертации

### 1. **Разбиение на ячейки**
```kotlin
val cellSize = maxOf(1, (params.cell / 100f * 3f + 1f).toInt())
// CELL = 0  → cellSize = 1 пиксель
// CELL = 50 → cellSize = 2.5 пикселя  
// CELL = 100→ cellSize = 4 пикселя
```

### 2. **Вычисление яркости**
```kotlin
val avgGray = calculateAverageGray(grayValues, x, y, cellSize, width, height)
// Берем среднее значение яркости в области cellSize × cellSize
```

### 3. **Выбор символа**
```kotlin
val charIndex = (avgGray * (asciiChars.length - 1) / 255).toInt()
val char = asciiChars[charIndex]
// 0-255 яркость → 0-69 индекс символа
```

### 4. **Набор символов (от темного к светлому)**
```
" .'`^\",:;Il!i><~+_-?][}{1)(|\\/tfjrxnuvczXYUJCLQ0OZmwqpdbkhao*#MW&8%B@$"
  ↑                                                                    ↑
самый темный                                                    самый светлый
```

## 🖥️ Отображение на экране

### **Проблема выравнивания:**
```kotlin
// ДО (проблема):
fontSize = 4.sp  // Фиксированный размер
lineHeight = 4.sp
// Результат: символы могут не заполнить экран

// ПОСЛЕ (решение):
val maxLineLength = lines.maxOfOrNull { it.length } ?: 1
val fontSize = (screenWidth * 0.7f / maxLineLength).coerceIn(2f, 4f).sp
lineHeight = fontSize * 0.9f  // Уменьшаем межстрочный интервал
// Результат: символы заполняют весь экран
```

## 🎛️ Параметры эффекта

### **CELL (0-100)**
- **0**: Очень мелкие ячейки (1 пиксель) → больше деталей
- **50**: Средние ячейки (2.5 пикселя) → баланс
- **100**: Крупные ячейки (4 пикселя) → меньше деталей, больше символов

### **JITTER (0-100)**
- **0**: Статичные символы
- **50**: Средняя анимация
- **100**: Быстрая анимация (случайная замена символов)

### **SOFTY (0-100)**
- **0**: Резкие границы
- **50**: Среднее размытие
- **100**: Сильное размытие

## 🚨 Причины неполного заполнения экрана

### **1. Несоответствие размеров**
```kotlin
// Проблема:
ASCIIEngine генерирует: 200 × 150 символов
ASCIIPreview отображает: fontSize = 4.sp
// Результат: символы не заполняют экран
```

### **2. Межстрочный интервал**
```kotlin
// Проблема:
lineHeight = fontSize  // Слишком большой интервал
// Результат: пробелы между строками
```

### **3. Фиксированный размер шрифта**
```kotlin
// Проблема:
fontSize = 4.sp  // Не зависит от размера экрана
// Результат: на больших экранах символы маленькие
```

## ✅ Решение

### **Адаптивный размер шрифта:**
```kotlin
val fontSize = (screenWidth * 0.7f / maxLineLength).coerceIn(2f, 4f).sp
// Размер шрифта адаптируется под ширину экрана и количество символов
```

### **Уменьшенный межстрочный интервал:**
```kotlin
lineHeight = fontSize * 0.9f
// Убираем лишние пробелы между строками
```

### **Увеличенная плотность сетки:**
```kotlin
val charsPerRow = minOf(250, (screenWidth / (fontSize * 0.4f)).toInt())
val rowsCount = minOf(200, (screenHeight / (fontSize * 0.8f)).toInt())
// Больше символов для лучшего заполнения
```
