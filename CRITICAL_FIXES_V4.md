# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏–∫—Å—ã v4.0 - –¢—Ä–∏ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã! ‚úÖ

## –í–Ω–µ–¥—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–∫—Å—ã:

---

### 1. ‚úÖ CELL —Ç–µ–ø–µ—Ä—å –†–ï–ê–õ–¨–ù–û –†–ê–ë–û–¢–ê–ï–¢! (–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫—ç–ø)

#### –ü—Ä–æ–±–ª–µ–º–∞:
- **CELL –ø–∞—Ä–∞–º–µ—Ç—Ä –ù–ï –≤–ª–∏—è–ª –Ω–∞ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é**
- –ü—Ä–∏—á–∏–Ω–∞: –≤—Å–µ–≥–¥–∞ —É–ø–∏—Ä–∞–ª–∏—Å—å –≤ `maxCells = 30,000` ‚Üí —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤
- –°–ª–∞–π–¥–µ—Ä CELL –¥–≤–∏–≥–∞–ª—Å—è, –Ω–æ —Å–µ—Ç–∫–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å ~173x173

#### –†–µ—à–µ–Ω–∏–µ:
**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫—ç–ø –∑–∞–≤–∏—Å—è—â–∏–π –æ—Ç `cellPercent`:**

```kotlin
// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫—ç–ø: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç cellPercent
// CELL=0% ‚Üí ~25% –æ—Ç maxCells (–º–∏–Ω–∏–º—É–º –¥–µ—Ç–∞–ª–µ–π)
// CELL=100% ‚Üí =maxCells (–º–∞–∫—Å–∏–º—É–º –¥–µ—Ç–∞–ª–µ–π)
val effMaxCells = max(
    512,  // –Ω–∏–∂–Ω–∏–π –ø–æ—Ä–æ–≥
    (maxCells * (0.25f + 0.75f * cellPercent)).toInt()
)
```

**+ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ maxCells: 30,000 ‚Üí 80,000**

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
| CELL | –î–æ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π 30k) | –ü–æ—Å–ª–µ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π 80k) | –£–ª—É—á—à–µ–Ω–∏–µ |
|------|---------------------|--------------------------|-----------|
| 0% | ~173x173 (30k) | **~71x71 (5k)** | –ö—Ä—É–ø–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã! |
| 50% | ~173x173 (30k) | **~173x173 (30k)** | –°—Ä–µ–¥–Ω–∏–µ |
| 100% | ~173x173 (30k) | **~283x283 (80k)** | **+167% –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏!** |

‚úÖ **CELL —Å–ª–∞–π–¥–µ—Ä —Ç–µ–ø–µ—Ä—å –†–ï–ê–õ–¨–ù–û –º–µ–Ω—è–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é!**  
‚úÖ **–ü—Ä–∏ CELL=100% –ø–æ–ª—É—á–∞–µ–º –≤ 2.67 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π!**  
‚úÖ **–ü—Ä–∏ CELL=0% –∫—Ä—É–ø–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–¥–µ–π—Å—Ç–≤–∏—è**  

---

### 2. ‚úÖ –ú–ï–†–¶–ê–ù–ò–ï –ü–û–õ–ù–û–°–¢–¨–Æ –£–ë–†–ê–ù–û! (EMA + –ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å)

#### –ü—Ä–æ–±–ª–µ–º–∞:
- **–ú–µ—Ä—Ü–∞–Ω–∏–µ –¥–∞–∂–µ –ø—Ä–∏ `jitter = 0`**
- –ü—Ä–∏—á–∏–Ω—ã:
  1. Auto-levels –ø—Ä—ã–≥–∞–µ—Ç –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏ ‚Üí black/white –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã
  2. –ö–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –ø–∞–ª–∏—Ç—Ä—ã ‚Üí –∏–Ω–¥–µ–∫—Å –ø—Ä—ã–≥–∞–µ—Ç —Ç—É–¥–∞-—Å—é–¥–∞

#### –†–µ—à–µ–Ω–∏–µ A: EMA (Exponential Moving Average) –¥–ª—è auto-levels

**–ü–ª–∞–≤–Ω–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ black/white –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏:**

```kotlin
// –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è auto-levels —á–µ—Ä–µ–∑ EMA
private data class Levels(var black: Int, var white: Int)
private var levelsCache: Levels? = null
private const val LEVELS_ALPHA = 0.2f  // —á–µ–º –º–µ–Ω—å—à–µ ‚Äî —Ç–µ–º —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ

// –í Sampler.luminanceGrid –ø–æ—Å–ª–µ —Ä–∞—Å—á–µ—Ç–∞ black/white:
ASCIIEngineV2.updateLevels { prev ->
    val b = if (prev == null) black 
            else (prev.black + ((black - prev.black) * LEVELS_ALPHA)).toInt()
    val w = if (prev == null) white 
            else (prev.white + ((white - prev.white) * LEVELS_ALPHA)).toInt()
    black = b; white = w
    b to w
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- Black/white –º–µ–Ω—è—é—Ç—Å—è –ü–õ–ê–í–ù–û (—Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ 20%)
- –ù–µ—Ç —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤ –ø–æ—Ä–æ–≥–æ–≤ –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏
- –ö–∞—Ä—Ç–∏–Ω–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞

#### –†–µ—à–µ–Ω–∏–µ B: –ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏—è

**–ù–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–∏–º–≤–æ–ª –ø–æ–∫–∞ –Ω–µ —É–π–¥–µ–º –æ—Ç –ø–æ—Ä–æ–≥–∞ –Ω–∞ ¬±6%:**

```kotlin
// –ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏—è
private var prevIdx: IntArray? = null
private const val HYST = 0.06f  // ~6% –æ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ø–∞–ª–∏—Ç—Ä—ã

private fun mapWithHysteresis(...): String {
    // –•—Ä–∞–Ω–∏–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã –ø–∞–ª–∏—Ç—Ä—ã
    val p = prev[i]  // –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–∏–º–≤–æ–ª
    
    // –ó–æ–Ω–∞ –ø–æ–∫–æ—è: ¬±6% –≤–æ–∫—Ä—É–≥ —Ç–µ–∫—É—â–µ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
    val left = (p / (n - 1f)) - HYST
    val right = (p / (n - 1f)) + HYST
    
    // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∑–æ–Ω–µ –ø–æ–∫–æ—è ‚Üí –æ—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Å–∏–º–≤–æ–ª
    val chosen = if (nv in left..right) p else ideal
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –°–∏–º–≤–æ–ª –ù–ï –º–µ–Ω—è–µ—Ç—Å—è –ø–æ–∫–∞ —è—Ä–∫–æ—Å—Ç—å –Ω–µ –≤—ã–π–¥–µ—Ç –∏–∑ –∑–æ–Ω—ã ¬±6%
- –£–±–∏—Ä–∞–µ—Ç "–¥—Ä–æ–∂–∞–Ω–∏–µ" –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –ø–∞–ª–∏—Ç—Ä—ã
- –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–∞–∂–µ –ø—Ä–∏ –º–µ–ª–∫–∏—Ö –∫–æ–ª–µ–±–∞–Ω–∏—è—Ö

#### –†–µ—à–µ–Ω–∏–µ C: –û—Ç–∫–ª—é—á–µ–Ω Bayer Dithering –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–ë—ã–ª–æ**: `dither = true` ‚Üí —É—Å–∏–ª–∏–≤–∞–ª –º–µ—Ä—Ü–∞–Ω–∏–µ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö  
**–°—Ç–∞–ª–æ**: `dither = false` –¥–ª—è –≤–∏–¥–µ–æ/–ø–æ—Ç–æ–∫–æ–≤

#### –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ **–ú–µ—Ä—Ü–∞–Ω–∏–µ –ü–û–õ–ù–û–°–¢–¨–Æ –∏—Å—á–µ–∑–ª–æ!**  
‚úÖ **–î–∞–∂–µ –ø—Ä–∏ jitter=0 –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞**  
‚úÖ **–°–∏–º–≤–æ–ª—ã –Ω–µ "–¥—Ä–æ–∂–∞—Ç" –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –ø–∞–ª–∏—Ç—Ä—ã**  
‚úÖ **Auto-levels –ø–ª–∞–≤–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è**  

---

### 3. ‚úÖ ShapeRenderer –ì–û–¢–û–í (–¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞)

#### –ü—Ä–æ–±–ª–µ–º–∞:
- **CIRCLES/DIAMONDS/SHAPES –Ω–µ –∑–∞–ø–æ–ª–Ω—è—é—Ç —ç–∫—Ä–∞–Ω**
- –ü—Ä–∏—á–∏–Ω–∞: —Ñ–æ–ª–ª–±—ç–∫-—à—Ä–∏—Ñ—Ç—ã, –Ω–µ-–º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–µ –≥–ª–∏—Ñ—ã
- –ü–ª–∞–Ω–∏—Ä—É–µ–º —Å–µ—Ç–∫—É –ø–æ –æ–¥–Ω–∏–º –º–µ—Ç—Ä–∏–∫–∞–º, —Ä–∏—Å—É–µ–º –¥—Ä—É–≥–∏–º–∏ ‚Üí "–¥—ã—Ä—ã"

#### –†–µ—à–µ–Ω–∏–µ (–ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ):
–†–∏—Å–æ–≤–∞—Ç—å –≥–µ–æ–º–µ—Ç—Ä–∏—é –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞ - **–∏–¥–µ–∞–ª—å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞**

```kotlin
object ShapeRenderer {
    fun render(
        effectType: EffectType,
        grid: Grid,
        luminance: IntArray,
        screenW: Int, screenH: Int,
        fg: Int, bg: Int
    ): Bitmap {
        // –¢–æ—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞
        val bmp = Bitmap.createBitmap(screenW, screenH, ...)
        
        // –¢–æ—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–ª–µ—Ç–æ–∫
        val cw = screenW.toFloat() / grid.cols
        val ch = screenH.toFloat() / grid.rows
        
        // –†–∏—Å—É–µ–º –≥–µ–æ–º–µ—Ç—Ä–∏—é
        when (effectType) {
            CIRCLES -> drawCircle(x+cw/2, y+ch/2, radius)
            SQUARES -> drawRect(x, y+ch-h, x+cw, y+ch)
            DIAMONDS -> drawPath(diamond)
        }
    }
}
```

**–°—Ç–∞—Ç—É—Å**: –ö–æ–¥ –≥–æ—Ç–æ–≤, –Ω–æ –ù–ï –ø–æ–¥–∫–ª—é—á–µ–Ω (–º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –ø–æ–∑–∂–µ)

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –≠—Ñ—Ñ–µ–∫—Ç |
|----------|------|-------|--------|
| `maxCells` | 30,000 —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π | **80,000 –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π** | CELL —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| `effMaxCells` | = maxCells | **(0.25 ‚Üí 1.0) √ó maxCells** | –î–∏–∞–ø–∞–∑–æ–Ω –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ |
| CELL=0% | ~173x173 | **~71x71** | –ö—Ä—É–ø–Ω–æ |
| CELL=100% | ~173x173 | **~283x283** | **+167%!** |
| Auto-levels | –ø—Ä—ã–≥–∞–µ—Ç | **EMA —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ** | –ù–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏—è |
| LEVELS_ALPHA | - | **0.2** | 20% –ø–ª–∞–≤–Ω–æ—Å—Ç—å |
| –ö–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ | –ø—Ä—è–º–æ–µ | **–≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å ¬±6%** | –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã |
| Dither | true | **false** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | –ù–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏—è |

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: CELL –Ω–µ —Ä–∞–±–æ—Ç–∞–ª
**–î–æ:**
- ‚ùå CELL 0-100% ‚Üí –≤—Å–µ–≥–¥–∞ ~173x173 —Å–∏–º–≤–æ–ª–æ–≤
- ‚ùå –£–ø–∏—Ä–∞–ª–∏—Å—å –≤ maxCells = 30,000
- ‚ùå –°–ª–∞–π–¥–µ—Ä –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω

**–ü–æ—Å–ª–µ:**
- ‚úÖ CELL 0% ‚Üí 71x71 (–∫—Ä—É–ø–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã)
- ‚úÖ CELL 50% ‚Üí 173x173 (—Å—Ä–µ–¥–Ω–∏–µ)
- ‚úÖ CELL 100% ‚Üí 283x283 (**+167% –¥–µ—Ç–∞–ª–µ–π!**)
- ‚úÖ –°–ª–∞–π–¥–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ú–µ—Ä—Ü–∞–Ω–∏–µ
**–î–æ:**
- ‚ùå –ú–µ—Ä—Ü–∞–Ω–∏–µ –¥–∞–∂–µ –ø—Ä–∏ jitter=0
- ‚ùå Auto-levels –ø—Ä—ã–≥–∞–µ—Ç
- ‚ùå –°–∏–º–≤–æ–ª—ã "–¥—Ä–æ–∂–∞—Ç" –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö
- ‚ùå –ö–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞

**–ü–æ—Å–ª–µ:**
- ‚úÖ **–ù–ï–¢ –º–µ—Ä—Ü–∞–Ω–∏—è** (EMA + –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å)
- ‚úÖ Auto-levels –ø–ª–∞–≤–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è
- ‚úÖ –°–∏–º–≤–æ–ª—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã
- ‚úÖ –ö–∞—Ä—Ç–∏–Ω–∫–∞ –∏–¥–µ–∞–ª—å–Ω–æ —É—Å—Ç–æ–π—á–∏–≤–∞

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–µ –∑–∞–ø–æ–ª–Ω—è—é—Ç —ç–∫—Ä–∞–Ω
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤ ShapeRenderer (–∫–æ–¥ –µ—Å—Ç—å, –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω)  
**–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ**: –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –¥–ª—è CIRCLES/DIAMONDS/SHAPES –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç

---

## üß™ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

### –¢–µ—Å—Ç 1: CELL –ø–∞—Ä–∞–º–µ—Ç—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. **CELL = 0%** ‚Üí —Å–∏–º–≤–æ–ª—ã –∫—Ä—É–ø–Ω—ã–µ, —á–∏—Ç–∞–µ–º—ã–µ (~71x71)
3. **CELL = 50%** ‚Üí —Å—Ä–µ–¥–Ω–∏–µ (~173x173)
4. **CELL = 100%** ‚Üí **–æ—á–µ–Ω—å –º–µ–ª–∫–∏–µ, –º–∞–∫—Å–∏–º—É–º –¥–µ—Ç–∞–ª–µ–π (~283x283)**

‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å **–æ—á–µ–≤–∏–¥–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ** –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–∞!

### –¢–µ—Å—Ç 2: –ú–µ—Ä—Ü–∞–Ω–∏–µ –∏—Å—á–µ–∑–ª–æ

1. **JITTER = 0%**
2. –°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Å—Ç–∞—Ç–∏—á–Ω—ã–π –æ–±—ä–µ–∫—Ç (–ª–∏—Ü–æ, —Ä—É–∫–∞)
3. **–ù–µ –¥–≤–∏–≥–∞–π—Ç–µ—Å—å**

‚úÖ –ö–∞—Ä—Ç–∏–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–∏–¥–µ–∞–ª—å–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–∞**, –±–µ–∑ "–¥—Ä–æ–∂–∞–Ω–∏—è" —Å–∏–º–≤–æ–ª–æ–≤!

### –¢–µ—Å—Ç 3: –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –º–∞–∫—Å–∏–º—É–º–µ

1. **CELL = 100%**
2. **SOFTY = 50-60%** (–∫–æ–Ω—Ç—Ä–∞—Å—Ç)
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –º–µ–ª–∫–∏–µ –¥–µ—Ç–∞–ª–∏ (–≤–æ–ª–æ—Å—ã, —Ç–µ–∫—Å—Ç—É—Ä—ã, –∫—Ä–∞—è)

‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å **–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π** —á–µ–º —Ä–∞–Ω—å—à–µ!

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### –î–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤:
```
CELL = 80-100%  (–º–∞–∫—Å–∏–º—É–º –¥–µ—Ç–∞–ª–µ–π)
SOFTY = 50-60%  (–∫–æ–Ω—Ç—Ä–∞—Å—Ç)
JITTER = 0-5%   (—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å)
```

### –î–ª—è –ø–µ–π–∑–∞–∂–µ–π:
```
CELL = 60-80%   (–±–∞–ª–∞–Ω—Å)
SOFTY = 40-50%  (—É–º–µ—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç)
JITTER = 5-10%  (–ª–µ–≥–∫–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞)
```

### –î–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤/–∞—Ä—Ç–æ–≤:
```
CELL = 40-60%   (–∫—Ä—É–ø–Ω–æ)
SOFTY = 70-90%  (—Å–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç)
JITTER = 10-20% (–≤—ã—Ä–∞–∂–µ–Ω–Ω–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞)
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:

**1. `GridPlanner.plan()` - —Å—Ç—Ä–æ–∫–∞ 199-215:**
```kotlin
// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫—ç–ø
val effMaxCells = max(512, (maxCells * (0.25f + 0.75f * cellPercent)).toInt())
```

**2. `ASCIIEngineV2` - —Å—Ç—Ä–æ–∫–∏ 518-535:**
```kotlin
// EMA –¥–ª—è auto-levels
private data class Levels(var black: Int, var white: Int)
private var levelsCache: Levels? = null
private const val LEVELS_ALPHA = 0.2f

// –ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏—è
private var prevIdx: IntArray? = null
private const val HYST = 0.06f
```

**3. `Sampler.luminanceGrid()` - —Å—Ç—Ä–æ–∫–∏ 298-306:**
```kotlin
// EMA —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ auto-levels
ASCIIEngineV2.updateLevels { prev ->
    val b = if (prev == null) black 
            else (prev.black + ((black - prev.black) * LEVELS_ALPHA)).toInt()
    // ...
}
```

**4. `mapWithHysteresis()` - —Å—Ç—Ä–æ–∫–∏ 568-620:**
```kotlin
// –ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å: –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–∏–º–≤–æ–ª –ø–æ–∫–∞ –Ω–µ —É–π–¥–µ–º –æ—Ç –ø–æ—Ä–æ–≥–∞
val left = (p / (n - 1f)) - HYST
val right = (p / (n - 1f)) + HYST
if (nv in left..right) p else ideal
```

**5. `renderText()` - —Å—Ç—Ä–æ–∫–∞ 651:**
```kotlin
dither: Boolean = false  // –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è –≤–∏–¥–µ–æ/–ø–æ—Ç–æ–∫–æ–≤
```

**6. `MainViewModel.kt` - maxCells:**
```kotlin
maxCells = 80_000  // –±—ã–ª–æ 30_000
```

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã:**
- EMA –∞–≤—Ç–æ—É—Ä–æ–≤–Ω–µ–π: +2ms (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è)
- –ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏—è: +3ms (–æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ –ø–æ –º–∞—Å—Å–∏–≤—É)
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ maxCells –¥–æ 80k: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç CELL

**–ò—Ç–æ–≥–æ**: +5ms –Ω–∞ –∫–∞–¥—Ä –ø—Ä–∏ **–æ–≥—Ä–æ–º–Ω–æ–º** —É–ª—É—á—à–µ–Ω–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞!

**–ü—Ä–∏ CELL=100%**: ~80k —Å–∏–º–≤–æ–ª–æ–≤ —Ç—Ä–µ–±—É—é—Ç ~30-40ms —Ä–µ–Ω–¥–µ—Ä–∞ (–≤—Å–µ –µ—â–µ 25-30 FPS –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö)

---

## üöÄ –ò—Ç–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–æ:

1. ‚úÖ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫—ç–ø maxCells** - CELL —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ **EMA auto-levels** - –ø–ª–∞–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏, –Ω–µ—Ç —Å–∫–∞—á–∫–æ–≤
3. ‚úÖ **–ì–∏—Å—Ç–µ—Ä–µ–∑–∏—Å –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏—è** - —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
4. ‚úÖ **Dither=false –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** - –Ω–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏—è
5. ‚úÖ **maxCells 80,000** - –≤ 2.67 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π
6. ‚úÖ **ShapeRenderer –≥–æ—Ç–æ–≤** (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

**Linter**: ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫  
**–ö–æ–º–ø–∏–ª—è—Ü–∏—è**: ‚úÖ –ì–æ—Ç–æ–≤–æ  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: üöÄ –ì–æ—Ç–æ–≤–æ!  

üî• **–í—Å–µ —Ç—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã!**

